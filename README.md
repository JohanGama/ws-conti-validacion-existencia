

# Archetype Base:

Archetype base contains the following preconfigured components:

- Azure Key vault source configuration.
- Pipelines source configuration (CI/CD).
- Openshift resources base.
- Transformation route.
- Sample Unit Test
- Code coverage and sonarqube extension with Jacoco plugin.
- Configuration Health Check.

## About code Structure Packages

You can find the following structure package in the generated project, that should be necessary for organize your code:

**configuration:** config classes

**routes:** camel routes

**tranformation:** transformation beans

**properties:** properties interfaces.

The structure of the source code generated by the archetype is a Maven project, which follows Quarkus plugin configurations and property settings. https://quarkus.io/guides/

The structure of naming classes, methods, attributes and in general about the source code, it is recommended to use the official Google guide for Java naming https://google.github.io/styleguide/javaguide.html

This archetype generates projects with dev services enabled, see https://quarkus.io/guides/dev-services

## OpenAPI Recommendations

Use openapi annotations to document your models and operations, an example is provided with responses.

## Model Validation Recommendations

Use Javax validator API to validate your models.

## Model DTO Recommendations

Use Java 17 Records on your model package to define simple DTOs.

## Properties variables Recommendations

Use interfaces to define properties variables.

https://quarkus.io/guides/config-mappings

Then use as environment variables with UPPER_CASE on openshift resources base yaml.

https://quarkus.io/guides/config-reference

## Dev services URL

Dev services url for access web developer console http://localhost:8080/q/dev

## Local deployment without dev services

In case you need to test locally database connections add `quarkus.datasource.reactive.url` property and credentials.

https://quarkus.io/guides/reactive-sql-clients

**Remove credentials and connection string before deploy or commit in you git repository**

## Unit Tests

All units tests should be working with test containers technology, restAssured, Wiremock and Mockito.

- Database unit test loads a SQL server container image.
- Rest Clients loads a Wiremock http server
- Blob storage loads an Local Azure Storage service using Azurite container image.
- AMQ unit test loads and AMQ container image.
- Auth Tests loads a Keycloak Container image.

For mock support with Mockito, visit https://quarkus.io/blog/mocking/

For information and guides visit: https://www.testcontainers.org/

For restAssured testing visit: https://github.com/rest-assured/rest-assured/wiki/Usage


## Testing and dev mode with Podman

If you use podman as local container platform, follow the official guide for configure your machine:

https://quarkus.io/blog/quarkus-devservices-testcontainers-podman/

Relevant variables:

`export DOCKER_HOST=unix:///run/user/${UID}/podman/podman.sock`

`export TESTCONTAINERS_RYUK_DISABLED=true`

## Creating native runner:

Execute the following goal to create a native app in local machine:

`mvn package -Pnative -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman -Dquarkus.native.builder-image=registry.access.redhat.com/quarkus/mandrel-22-rhel8:latest`

## Testing with sonarQube Local Container Image

Run sonarqube on local machine using a image container, this is only necessary if you wanna test sonarqube rules locally.

https://docs.sonarqube.org/latest/try-out-sonarqube/

`docker run -d --name sonarqube -e SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true -p 9000:9000 sonarqube:latest`

Generate A token from web console and run the following goal.

`mvn clean verify sonar:sonar -Dsonar.login=myAuthenticationToken`
